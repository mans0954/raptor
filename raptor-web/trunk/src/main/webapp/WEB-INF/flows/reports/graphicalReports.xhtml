<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:sf="http://www.springframework.org/tags/faces"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/templates/raptor/full.xhtml">


	<ui:define name="content">
		<rich:layout>

			<rich:layoutPanel position="top">


				<rich:simpleTogglePanel switchType="client" label="Control Panel"
					opened="true">

					<rich:layout>
						<rich:layoutPanel position="left" width="40%">
							<a4j:form id="ControlPanelForm">

								<rich:datascroller for="statisticalUnitsTable" maxPages="10" />
								<rich:dataTable id="statisticalUnitsTable"
									value="#{flowScope.websession.graphmodel.statisticalUnitsForView}"
									bandingInterval="2" banding="row" var="unit" width="100%"
									labelWidth="0%" rows="10" inlineStyle="border-style: hidden;"
									rendered="#{not empty flowScope.websession.graphmodel.statisticalUnitsForView}">

									<f:facet name="header">
										<h:outputText
											value="#{graphService.attachedCapabilities.muaMetadata.muaName}" />
									</f:facet>


									<rich:column>
										<f:facet name="header">
											<h:outputText value="Statistic" />
										</f:facet>
										<a4j:commandLink ajaxSingle="true"
											value="#{unit.statisticalUnitInformation.statisticParameters.unitName}"
											action="invokeStatisticalUnit"
											reRender="chartForm,graphImage,optionsPanel,ControlPanelForm">
											<f:setPropertyActionListener value="#{unit}"
												target="#{flowScope.websession.graphmodel.selectedStatisticalUnit}" />
										</a4j:commandLink>

									</rich:column>

									<rich:column>
										<f:facet name="header">
											<h:outputText value="Modify" />
										</f:facet>
										<a4j:commandLink ajaxSingle="true"
											reRender="optionsPanel,ControlPanelForm">
											<h:graphicImage value="/image/icon/onebit_20.png"
												style="border:0; margin-left: auto;margin-right: auto;"
												width="20px" rendered="#{!unit.selected}" />
											<h:graphicImage value="/image/icon/onebit_27.png"
												style="border:0; margin-left: auto;margin-right: auto;"
												width="20px" rendered="#{unit.selected}" />
											<f:setPropertyActionListener value="#{unit}"
												target="#{flowScope.websession.graphmodel.selectedStatisticalUnit}" />
										</a4j:commandLink>
									</rich:column>
								</rich:dataTable>
							</a4j:form>
						</rich:layoutPanel>



						<rich:layoutPanel position="right">
							<a4j:form id="optionsPanelForm">
								<rich:panel width="100%" id="optionsPanel">
									<f:facet name="header">
                                        Options
                                     </f:facet>

									<h:panelGrid columns="2" width="50%">

										<h:outputText value="Method Name:" style="font-weight: bold;" />
										<h:outputText
											value="#{flowScope.websession.graphmodel.selectedStatisticalUnit.statisticalUnitInformation.statisticParameters.methodName}" />


										<h:outputText value="Start Time:" style="font-weight: bold;" />
										<rich:calendar id="startTimeDate" showApplyButton="true"
											datePattern="dd/MM/yyyy HH:mm"
											value="#{flowScope.websession.graphmodel.selectedStatisticalUnit.statisticalUnitInformation.statisticParameters.startTimeAsJavaDate}">
										</rich:calendar>


										<h:outputText value="End Time:" style="font-weight: bold;" />
										<rich:calendar id="endTimeDate" showApplyButton="true"
											datePattern="dd/MM/yyyy HH:mm"
											value="#{flowScope.websession.graphmodel.selectedStatisticalUnit.statisticalUnitInformation.statisticParameters.endTimeAsJavaDate}">
										</rich:calendar>


										<h:outputText value="Parameters:" style="font-weight: bold;" />
										<rich:dataTable
											value="#{flowScope.websession.graphmodel.selectedStatisticalUnit.statisticalUnitInformation.statisticParameters.methodParams}"
											var="parameter" width="95%" labelWidth="5%"
											style="border-style: hidden;">
											<rich:column inlineStyle="border-style: hidden;">
												<h:inputText value="#{parameter.parameter}">													
												</h:inputText>
											</rich:column>
										</rich:dataTable>


										<h:outputText value="Graph Title:" style="font-weight: bold;" />
										<h:inputText
											value="#{flowScope.websession.graphmodel.selectedStatisticalUnit.statisticalUnitInformation.statisticParameters.presentation.graphTitle}" />

										<h:outputText value="Preprocessors:"
											style="font-weight: bold; width:100%" />
										<h:inputText
											value="#{flowScope.websession.graphmodel.selectedStatisticalUnit.statisticalUnitInformation.preProcessorsAsString}" />


										<h:outputText value="Postprocessors:"
											style="font-weight: bold;" />
										<h:inputText
											value="#{flowScope.websession.graphmodel.selectedStatisticalUnit.statisticalUnitInformation.postProcessorsAsString}" />



										<f:facet name="footer">
											<h:panelGroup style="display:block; text-align:center">
												<a4j:commandButton ajaxSingle="false" value="update"
													reRender="chartForm, ControlPanelForm" >
													<!--  added the support here, as the command button needs to submit the form properties, which it only does
													with ajaxSingle="false", then invoke the action, which only happens when ajaxSingle="true" -->
													<a4j:support ajaxSingle="true" event="oncomplete" action="updateMUAStatistic" reRender="optionsPanelForm,controlPanelForm, chartForm" />
													
												</a4j:commandButton>
											</h:panelGroup>
										</f:facet>

									</h:panelGrid>
								</rich:panel>
							</a4j:form>
						</rich:layoutPanel>


					</rich:layout>

				</rich:simpleTogglePanel>

			</rich:layoutPanel>


			<rich:layoutPanel position="bottom">

				<a4j:form id="chartForm">

					<rich:tabPanel id="chartTabPanel" height="450" selectedTab="graph"
						switchType="client">


						<rich:tab name="graph" label="Graph">
							<h:graphicImage id="graphImage"
								rendered="#{not empty flowScope.websession.graphmodel.currentJFreeGraph.relativeChartLocationPath}"
								value="#{flowScope.websession.graphmodel.currentJFreeGraph.relativeChartLocationPath}"
								width="100%" />

							<rich:simpleTogglePanel switchType="client" label="Graph Options"
								rendered="#{not empty flowScope.websession.graphmodel.currentJFreeGraph.relativeChartLocationPath}"
								opened="false">


							</rich:simpleTogglePanel>
						</rich:tab>


						<rich:tab name="table" label="Table">
							<rich:datascroller for="currentTableGraphTable" maxPages="10" />
							<rich:dataTable id="currentTableGraphTable"
								value="#{flowScope.websession.graphmodel.currentTableGraph.rowList}"
								bandingInterval="2" banding="row" rows="15" var="unit"
								width="100%"
								rendered="#{not empty flowScope.websession.graphmodel.currentTableGraph}">
								<f:facet name="header">
									<h:outputText
										value="#{flowScope.websession.graphmodel.selectedStatisticalUnit.statisticalUnitInformation.statisticParameters.unitName}" />
								</f:facet>
								<rich:columns
									value="#{flowScope.websession.graphmodel.currentTableGraph.series}"
									var="columns" index="index" id="column#{index}">
									<f:facet name="header">
										<h:outputText value="#{columns}" />
									</f:facet>
									<h:outputText value="#{unit[index]}" />
								</rich:columns>
							</rich:dataTable>

						</rich:tab>

						<rich:tab name="Download" label="Download">


							<h:outputText value="Select Download Format"
								style="text-align:center; font-weight:bold; font-size:150%" />

							<h:panelGrid id="reportTypePanel" columns="2">
								<a4j:commandLink id="generateExcelReport"
									action="generateExcelReport" reRender="chartForm">
									<h:graphicImage value="/image/excel-icon.gif" style="border:0">
									</h:graphicImage>

								</a4j:commandLink>

								<a4j:commandLink action="generateCSVReport" reRender="chartForm">
									<h:graphicImage value="/image/csv-icon.png" style="border:0">
									</h:graphicImage>
								</a4j:commandLink>
							</h:panelGrid>

							<rich:separator />
							<rich:spacer height="10px" />

							<rich:dataTable id="reportDownloadTable"
								value="#{flowScope.websession.reportmodel.reportsForDownload}"
								bandingInterval="2" banding="row" var="row"
								rendered="#{not empty flowScope.websession.reportmodel.reportsForDownload}"
								width="100%">

								<rich:column>
									<f:facet name="header">
										<h:outputText value="Report Name" />
									</f:facet>
									<h:outputText value="#{row.friendlyName} " />
								</rich:column>
								<rich:column align="center">
									<f:facet name="header">
										<h:outputText value="Download" />
									</f:facet>
									<a href="#{row.downloadPath}">download</a>
								</rich:column>
								<rich:column align="center">
									<f:facet name="header">
										<h:outputText value="Remove" />
									</f:facet>
									<a4j:commandLink id="removeReportCommandLink" value="x"
										action="removeReport" reRender="chartForm">
										<f:setPropertyActionListener value="#{row}"
											target="#{flowScope.websession.reportmodel.selectedDownloadFile}" />
									</a4j:commandLink>

								</rich:column>
							</rich:dataTable>


						</rich:tab>

					</rich:tabPanel>


				</a4j:form>

				<!-- RESULTS TABLE -->
				<!-- ________________________________ -->



			</rich:layoutPanel>


		</rich:layout>

	</ui:define>
</ui:composition>
